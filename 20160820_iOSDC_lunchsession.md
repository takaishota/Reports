# ランチセッション: 「東急ハンズのPOSから学んだ、業務iOSアプリの向き合い方」 ハンズラボ株式会社 黒岩裕輔

## POSってなに?
* Point of Sales

### 主な機能

#### 売上登録
* お客様が購入するものから売上きんがくを計算する

#### 決済
* 売上きんがくとお預かりきんがくから決済してお釣りを返す

#### 情報提供
* 在庫や売上などの情報更新、情報提供

## POを自社開発する理由

* レジをお客様とのコミュニケーションの場にするため
* 開発運用費の削減

## 旧POS
* 一般的なPOS
* 自動釣銭機連動
* バーコード連動

## HandsPOS
* 機能はそのままでシンプルに
  * 必要なボタンだけを表示する、既存のPOSは必要なボタン以外も全て羅列されている
* 操作性を飛躍的に向上
* 自動釣銭機連動
* バーコード連動

## 特徴
### データ
* マスタダウンロード、保持
   サーバでのマスタの更新処理完了時にPush通知

### 表示
* 取引内容のカスタマディスプレイ表示

### 外部連携
* ポイント連携

## 開発環境
* Swift2.2
* CI: buddybuild
* SwiftLint
* Sketch
* Github、Slack

## Frameworks

### Multipeer Connectivity
  * iOS間通信

### Realm
  * マスタデータのCRUD

### ObjectMapper

### Swift Task

### Swift Bond

### StarScream
  * WebSocket Client
  * レシートプリンタとの連携のため

## 無線LANの問題
* ネットワークがぶちぶち切断
* レシートプリンタに命令が不達
* アクセスポイントの不調

## 無線がダメなら有線
* パケットロス、遅延を防止
* 有線はDHCPで稼働
* iOSは有線・無線両方のインタフェース動作（裏で）

## iOSを運用する上での課題
* ソフトウェアアップデート通知の表示を抑止
  * ファイアウォールで排除してる
* MDMからのアプリ配布（アップデート）を強制化する
  * アプリが落ちていないとダメだったのでPUSH通知でkillする脱獄で対応（エンタープライズなのでいける）
* アプリがバックグラウンド状態でのRealmの書き込み
  * バックグラウンド(suspend)だとバックグラウンドでのマスタデータ更新ができない
  * バックグラウンドで無音の音声を流して、無理やり書き込む対応

## 今後の機能
* カスタマディスプレイの有効活用
* 電子レシート
* 店員に配っているiPodTouchとの連携
  * 先に商品のスキャンだけレジに送るなど
* Apple Pay対応
