# Remixing with All About 6/27
------------------------

## ラフに始めるOSS活動
　OSS活動というとApacheやMySQLなどすごそうなものを想像するが、githubにアップしてライセンスを明記すれば、それも十分なOSS活動になると思います。

### npm
  * jsのパッケージ管理ツール
  * クライアントサイドでもバックエンドもある

### why use npm

#### 使う側からするとリポジトリに登録されていた方が使いやすい
  * git hubにアップしているだけだと、cloneしたり、ビルドしたりが手間になる（！）
  * npmだとバージョン管理もしてくれるし、モジュールの依存関係なども意識しなくて良いし、プロジェクトに入れるのも簡単

#### 作る側にもメリットがある
  * 人のソースコードを読むことにもつながる
  * きれいに描こうと意識する

### How to
  1. npmアカウントの作成
      https://www.npmjs.com/

  2. package JSONの準備
    プロジェクトの説明などのManifestファイル

  3. それっぽくソースコードを書く

  4. JSのモジュール管理
煩雑になるのでツールを使うことが多い
      1. CommonJS
        * npmと仲良し
        * node.jsからそのまま使える
        * browserifyでブラウザ上で使うことができる
      2. AMD
        * RequireJSがサポートしている
        * モジュールを非同期に読み込むのでブラウザにやさしい
      3. UMD
        * CommonJS,AMDのどちらのパターンもサポート
      4. ES6 modules
        * ES6で取り入れられるJSの構文でクライアントJSにモジュールの仕組みを取り入れるもの。
        * Babel（ECMAScript6のコードをECMAScript5に変換するツール）というのを利用すれば、ES6構文を動かせる環境が浸透していない状況でも使用できる。

  5. ReadMeを用意する
    * Name、OverView、Description、Demoなどが一般的
    * バージョンや開発状況を示すバッチを置くのがOSSではよくある
    バッジを作成してくれるサービスがある
        http://shields.io/

  6. 公開する

                npm publish


## オールアバウトのアプリ開発
　Cafe Snapというアプリを開発中。 http://cafesnap.me/
### 開発体制
  * 4人で開発
  * プロデューサー 2名
  * エンジニア    3名

  * 2014/5：開発スタート
  * 2014/9：サービスのリリース
  * 〜現在 ：運用、改善中

### どんな問題があったか

#### 開発初期
  iPhoneアプリ開発の経験がない状態から始めた
  * どうやったか
    * とりあえず、やってみようという姿勢
    * ライブラリを調査してできるだけ利用した

  * ダメだった場合にどうしたか
    * プロセスの共有
    * エンジニアだけでなく全員で考える

#### リリース後の不具合
  * 考慮不足による不具合が頻発した
    バグは必ずあるので検知するツールを早めに取り入れる
  * Crashlytics
    導入が簡単だった
  * TestFlight

#### マルチプラットフォーム化
　複数言語同時並行は難しい
* 開発者が少なかったのでiOS&Android&サーバサイドの開発切り替えが大変
    * 作業漏れが起きるようになった
    * iOSには入れたが、Androidには忘れたとか、、、
* タスク管理ツール Trelloを導入 https://trello.com/
    * 導入が簡単なものを選んだ
    * redmineでやっていたがより細かいタスクを登録できるため
    * Slack連携も簡単
    * chromeのExtensionもある
    * 工数が出せる
    * プラットフォームごとにタスク管理者を置いて管理している

## It's All About DevTools

### Setup
#### Chrome Canary
  Chromeの最新機能が追加されている開発者用のベータ版。バグが含まれているものもある。
  * 毎日アップデート
  * 並行インストール
  * たまに壊れる
  https://www.google.co.jp/chrome/browser/canary.html

#### Chromium
  ChromeのベースとなっているオープンソースブラウザでChromiumのスナップショットはChromeの最新ビルドとほぼ同じ
  https://github.com/chromium/chromium

#### 実験的機能の有効化
  * chrome://flags/#enable-devtools-experiments
  * ドキュメントはほぼない

### Chrome Canaryで最近導入された新機能の紹介
  * CSSのアニメーションタイムライン
  * Frame Viewer in Timeline
    合成レイヤーをタイムライン上で見れる
  * Filmstrip in Network and Timeline
    裏メニュー（Shift6回）
  * Blackboxing JavaScript
    デバッグのときに飛ばすJSを指定できる
  * Accessibility Inspection
  * Promiss Inspector
  * Working with Workspace
    * workspace devツール内にローカルディレクトリのファイルを読み込むことができる
    * devツールの変更自動的にローカルに保存してくれる
    * setting > workspace を選択し、ローカルフォルダを読み込む

### まとめ
  * Webの開発は年々スピードが上がっている
  * フロントエンドの開発者以外にも開発者ツールを使う必要が出てきている
  * FF、Safari、IEでも開発者ツールが追加されている

## APIで複数メディアを連携させるメリット・デメリット
複数メディアを持っている会社の悩み
  1. システム構成がバラバラ
    DB、フレームワーク、言語

  2. データの持ち方がバラバラ
    ユーザに表示されるHTMLがそのまま入ってたり、データだけがあったり

### 複雑化する要件
   エンタメ系のコンテンツを充実したいから、メディアA,B,C,Dからをエンタメ系記事の新着だけとってきて表示したい！
#### 開発者が考えたこと
  1. 各メディアのDBに直接つないで取ってくるプログラムをとってこよう
    * 1つのDBが落ちてるとシステムがダウンする
      耐障害性が低い
    * メディア分だけDB接続が必要
    実装が複雑化
    * 拡張性
    DBごとの使用知ってないとだめとか
  2. バッチでデータ作成して、1つのソースから取得
    * 耐障害性は上がる
    データを前もって準備できる
    * メディア数分のバッチ実装が必要
  3. APIを実装してAPI経由でデータ取得
    * 取得元プログラムがデータの持ち方を知らずに使用できる
    * 影響範囲の特定が容易
      APIのみ改修でOK
    * 拡張性も上がる

#### APIを使用した実例
  * 記事内容を解析して特徴的な内容でタグ付けする
  * タグ一覧ページがある
      記事タイトル、記事内容、記事概要が表示されるが
      各DBに値を持っている
  * 記事情報を返却するAPIを実装
  * タグ情報を返却するAPIを実装

#### 工夫した点
  * JSON形式で返却するように返却形式を共通化
      * DataとMetaから構成
      * ステータスコードの有効活用
          * ステータスコードを分かりやすく定義し直す
          * それを属人化しないようにドキュメント化
  * ライブラリ化
      APIを叩く実装部分の実装を共通化

#### まとめ
  * サービスの追加/削除の際、調査とリリースが作業時間のほとんどをしめる
  * API化するとそれを削減できる

## ドカドカDocker
　hairというサービスを開発中です

### Dockerとは
  * インフラをソースコードで管理
  同一性、可搬性があり、軽量

### インフラは状態管理がしづらい
    手作業で環境構築
    何を入れたか
    開発環境と本番環境で差異が出てしまう
### コンテナとは
    * VMでは仮想化環境の上でOSを丸ごと動かす
    * Dockerでは、HostOSを共有し、プロセスとして各環境をコンテナ上で動かす

### DockerFile
    環境構築のためのコマンドなどを記載する

### 導入するメリット
  * コンテナのイメージを配布することで完全に同一
  * 特定のベンダーにとらわれない
    * Immutable Infrastructure
      インフラを破棄、置き換えできるものと捉える

### Docker EcoSystem
    [Docker Habu resistory](https://registry.hub.docker.com/)
    * インフラディベロッパーがインフラを共有するためのサービス
    * jenkinsなどの公式イメージもある
    * イメージを継承してOS〜ミドルウェア〜Applicationをインストールできる

### Dockerを巡る最近の動き
    * Open Container Projectというのが6/23に発表された
    * Dockerがソースを提供し、MSが参加したので
    DockerでWindowsも動くようになった
      https://github.com/opencontainers/runc

### 開発中のサービスhairの環境
    AWS、Bitbucket、Jenkins、Docker

## Webメディア開発の変化とこれから

###  開発の内製化

#### 内製化までへの道のり
  過去には、、、
  * 本番へはFTPで直アップロード
  * バージョン管理もない

#### 内製化が本格化
  * Webアプリのフレームワーク刷新
  * バージョン管理導入
  など

#### よりモダンな開発環境へ
  * svnからgitへ
  * ネイティブアプリの開発
  など

### バージョン管理とテスト自動化

#### 数年前までは
  * svnでmasterのみの男らしい管理
  * レビューはmasterコミット後にたまにする程度
  * 気軽にコミットできない

#### svnからgitへの移行
  * 移行の手間はsvnの運用の複雑さによる
  * svnのログの引き継ぎが面倒

#### 現在の環境

  * git + Bitbucket
  * Git hub flow
  * Pull Request & Review Board
    Pull Requestだと毎回メールが飛んでしまうので

#### 切り替えたメリット
  * リリースミスがなくなった
  * レビュー時に動作確認しやすくなった
  * モダンなホスティングサービスが使える
  * branchを使った並行開発

#### フロントエンドのテスト
  * jenkinsがURLを元にテスト実行
  * selenium Web Driverを使ってjsのエラーチェック

#### サーバサイドのテスト
  * PRをjenkinsが検知
  * リポジトリをチェック
    * シンタックスエラーチェック
    * PHPunit
    * PHP_Code Snifer

#### テストのメリット
  * 別のURLで不具合が起きていても検知できる
  * ドキュメンチがなくても仕様が把握しやすい
  * 安心してリファクタリングができる

### 現状の課題と取り組み

#### 現状の課題
  * 既存サービスの運用・保守に時間を取られる
  * 内製化したメリットを活かしきれていない
    * 開発のスピード化
    * コストの削減
#### 取り組み
  * 広告配信サーバーのリプレイス
    昔からの基幹システムをずっと運用していた
  * 社内集計システムのクラウド化
    社内でのHadoop運用からTresureDataへ
  * 属人化の解消
    HipChatやQiita Teamを利用し、各人の調査時間の短縮

  * プロデューサーとエンジニアを協働させる
    * お互いにどういう考えで動いているかが見えづらく、不満や迷いが生まれていた
    * まず技術は置いといて、ユーザにとってどうかを考えてから、技術的なissueに移るように
  * チーム体制の見直し：事業別から機能別に
    エンジニア・プロデューサーを機能別にし、開発環境などを共有

## All AboutのDevOpsとリリースフロー
### 課題
  内製化から3〜4年経過したが、なかなか実現速度が上がらない
  * 原因
    * 開発者とインフラ運用のオーバヘッド
      * リリースする際にはインフラ運用チームに依頼して本番端末で調査
      * バグがあれば、開発者に調査を依頼

### DevOpsとは？
http://www.infoq.com/jp/news/2014/03/devops

#### 開発者と運用者の壁をなくす
  * 変化を容易にし、変化によるリスクを低減する
  * サイロ化の排除

#### 具体的な方法として
ツールと文化の改善
* ツール
  * 高速に安心してリリース
  * サーバにログインしない運用
  * モダンなフレームワークを導入
  など

* 文化
  * お互いを理解し、信頼する
  * 情報の見える化
  * 勉強会を行って知識の共有を行う
      など
#### リリースフローの改善
  * 過去
      依頼が多い、エラー・リリースなど
        効率が悪い、関係が悪くなる

  * リリースも開発者が責任を持ってリリースするべきでは？

  * リリースの開放
      * サーバにログインしなくて良い
      * GUIで簡単に設定
      * 履歴、権限管理できる
      * 通知、テスト自動化できるか
  * 変えなかった点
      リリースフォームの記入
        * 日時、理由を記入
        * 開発者、インフラメンバーに通知

    リリースサイクルの高速化につながった

#### 監視の解放
kibanaの導入
  * パフォーマンスの可視化
  * エラーサマリーメール

開発者から進んでバグを調査するようになり、アプリケーションエラーが減少

#### 現在の取り組み
      * インフラエンジニアがコードでDockerなどでインフラ構築
      * 開発者もコードでインフラ構築できるように
      * インフラエンジニアの役割はこういった基盤を整備することへ

#### 目標
  * 無駄な運用の削減
  * 個々のスキルアップ

  よりクリエイティブな仕事を！
