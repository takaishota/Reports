#  FirebaseとBigQueryによるアプリのKPI分析（CMの効果検証編）

* FRILの話

## マーケティング分析の重要性
* 成熟市場ではマーケティングの重要性がます
  * 現状の機能でユーザがほぼ満足
  * 規模でサービスが選ばれるようになる
* サービス規模が拡大して、ユーザ属性が属性が多様化

  -> 良いアプリを作るだけではサービスが成長しない

##  成熟市場でサービスを成長させるには
* 新規ユーザの獲得効率の改善
* ユーザの継続率を改善

-> どちらもKPI分析による改善が重要

## マーケティングとエンジニアの類似性
  * どちらもサービスの成長に貢献
  * どちらもKPIを計測してPDCAを回す
  * どちらも投資であり費用対効果

## FirebaseとBigQueryでのKPI分析

### KPI分析に重要なこと
* 可視化
* 要因分析

### 可視化
  * データを用いた議論が可能になる（異なるチーム間（開発<->マーケティングなど）では特に重要）
  * フリルではRedashを使用

### 要因分析
* KPIを分析して、増減の要因を特定
* 外部要因ではなく施策がヒットしたことを確認
  * CM期間中のインストール数が増加  
    -> オーガニックインストール数が増加しているか
    -> 放送地域のオーガニックインストール数が増加しているか
    -> 放送地域のターゲット視聴者層のオーガニックインストール数が増加しているか
    -> CMが効いてる

### FireBaseとBigQueryの連携
* BigQueryにデータを自動でExport
* Firebase Analyticsの生データが参照可能

### 参照できる自動計測イベント
* 初回起動
* セッション開始
* バージョンアップ
* 画面遷移（自動スクリーントラッキング）

### 参照できる自動計測ユーザ情報
* OSとアプリのバージョン
* 言語
* 国、地域（都道府県）、市区町村
* IDFA

## CMの費用対効果の改善
* インストール数は重要なKPIのひとつ
  * 同じ費用でより多くのインストールを獲得したい

* CMの費用対効果改善ポイント
  * 投下箇所
    -> 最適化は数字のみで改善できる
  * 広告内容

### 投下箇所と投下量の最適化
* 費用対効果の高い箇所の投下量を増やす
* 推定値を出して相対比較で判断

#### 都道府県別投下量の最適化
* 都道府県ごとのインストール数を取得
  * Dailyインストール数を取得

  ```SQL
  SELECT
    STRFTIME_UTC_USEC(DATE_ADD(event_dim.timestamp_micros, 9, 'HOUR'), '%Y-%m-%d') AS install_date,
    user_dim.geo_info.region AS region,
    EXACT_COUNT_DISTINCT(user_dim.device_info.resettable_device_id) AS install_count
  FROM
    your_table_name
  WHERE
    user_dim.geo_info.country = 'Japan'
    AND event_dim.name = 'first_open'
  GROUP BY install_date, region
  ORDER BY install_date ASC, install_count DESC
  ```
* ベースラインからの増分を出す
  * CMを行なっていない時期と比較
* 費用対効果（CPI）を出して相対比較
* 費用対費用対効果の良かった都道府県の投下量を増やす

## まとめ
* 成熟市場ではマーケティング分析が重要
  * KPIを追って改善するのは開発と同じ
* Firebase + BigQueryで詳細にKPIを分析
  * 全ユーザー全イベントの生データを集計可能
* KPI分析を用いてCMの費用対効果を改善
  * 都道府県単位など投下箇所を最適化

## FAQ
### 急にインストール数が増えることがあるか、対してどうみるか
* オーガニックだけを見る
* 社内で他に施策がないか
* 外的な要因としては、AppStoreのランキングがあがったことやTwitterで有名なアカウントにリツイートされたことなどによる影響がないかなど
